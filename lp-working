$ cat lpUtil.java
import java.io.*;
import java.util.*;

public class lpUtil{

        private ArrayList<Integer> Hand = new ArrayList<Integer>();

        public String prompt(String prompt){
                String input = null;
                System.out.print(prompt + " : ");
                try{
                        BufferedReader is = new BufferedReader (
                                new InputStreamReader(System.in));
                        input = is.readLine();
                        if(input.length() == 0) return null;
                } catch(IOException e){
                        System.out.println("IOException: " + e);
                }
                return input.toLowerCase();
        }
}
$ cat LiarsPokerTest.java 
import java.util.*;

public class LiarsPokerTest{

        public static void main (String[] args){
                System.out.println("Testing");
                lpPlayer player = new lpPlayer();
                lpPlayer other = new lpPlayer();
                other.setAI();
                player.setName("first");
                System.out.printf("Name is: %s\n", player.getName());
                player.setNext(other);
                other.setNext(player);
                System.out.printf("other Name is: %s\n", other.getName());
                player.deal(8);
                player.dump();

                for (int i = 0; i<10; i++){
                        System.out.println(player.howMany(i));
                }
                lpUtil util = new lpUtil();
                String output = util.prompt("Type something");
                System.out.printf("You typed: %s\n", output);


        }
}
$ cat lpPlayer.java
import java.util.*;

public class lpPlayer{

        private ArrayList<Integer> Hand = new ArrayList<Integer>();

        private lpPlayer nextPlayer;

        private int aiIndex = 0;

        private int totalWins = 0;

        lpUtil util = new lpUtil();

        private String playerName;

        // AI items

        private int[] counts = new int[10];
        private int bcount=0;
        private int bcard=0;
        private int scard=0;
        private int scount=0;
        private int lcard=0;

        private double[] opinions = new double[10];

        public void addWin(int win){
                totalWins += win;
        }

        public int getWins(){
                return(totalWins);
        }

        public void dumpCards(){
                System.out.printf("B %d %d - S %d %d - L %d \n", bcount, bcard, scount, scard, lcard);
        }

        public String bidAgent3(int highCount, int highCard){
                String output;
                int bidcount=0;
                int bidcard=-1;
                boolean willLie = false;

                //dump();
                //System.out.printf("B %d %d - S %d %d - L %d \n", bcount, bcard, scount, scard, lcard);

                if((lcard > highCard && highCount <= 2) || (highCount <= 1)){
                        //RND
                        //System.out.println("check to lie");
                        if(Math.random()*3 > 2){
                                //System.out.println("Gonna lie");
                                willLie = true;
                                bidcard = lcard;
                        }
                }
                if(!willLie){
                        // try Second best
                        if(scount >= highCount){
                                // RND split with BEST
                                //System.out.println("chose Second");
                                bidcard = scard;
                        }else{
                                //System.out.println("chose Best");
                                bidcard = bcard;
                        }
                }
                //System.out.printf("bidcard: %d\n",bidcard);
                if(bidcard > highCard){
                        output = String.format("bid %d %d", highCount, bidcard);
                }else{
                        output = String.format("bid %d %d", highCount+1, bidcard);
                }

                return(output);
        }

        public String turnAgent4(int highCount, int highCard){
                String output;
                double posStep = 1;
                double negStep = -0.4;
                double decayRate = 2;
                double opinCount;
                double opinionTreshold = 0.4;
                double opinion;

                // update opinions
                for(int i = 0; i < 10; i++){
                        if(i == highCard && highCount > 0){
                                opinions[i] += posStep;
                                System.out.printf("O up: %d\n", i);
                        } else if(opinions[i] > 0){  // decay
                                System.out.printf("O down: %d\n", i);
                                //opinions[i] -= negStep;
                                opinions[i] = opinions[i]/decayRate;
                        }
                }

                // call or bid
                opinion = opinions[highCard]/(opinions[highCard]+1);
                System.out.printf("O bid: %f\n", opinion);

                if(opinion > opinionTreshold){
                        opinCount = counts[highCard] + 2;
                } else {
                        opinCount = counts[highCard] + 1;
                }
                if(highCount > opinCount){
                        output = "call";
                }else{ //bid based on B S or L card
                        output = bidAgent3(highCount, highCard);
                        //System.out.printf("Bidding %s %d %d\n", output, bcount, bcard);
                }
                return(output);
        }


        public String takeTurn(int highCount, int highCard){
                String output = "AI";
                if(aiIndex == 1){
                        //System.out.printf("%s turn\n", playerName);
                        // Call
                        if(highCount > counts[highCard]+1){
                                output = "call";
                        }else{ //bid
                                output = String.format("bid %d %d", highCount+1, highCard);
                        }
                        return(output);
                }else if(aiIndex == 2){
                        //System.out.printf("%s turn\n", playerName);
                        //dump();
                        // Call
                        if(highCount > counts[highCard]+1){
                                output = "call";
                        }else{ //bid based on highest run 
                                if(bcard > highCard){
                                        output = String.format("bid %d %d", highCount, bcard);
                                }else{
                                        output = String.format("bid %d %d", highCount+1, bcard);
                                }
                                //System.out.printf("Bidding %s %d %d\n", output, bcount, bcard);
                        }
                        return(output);
                }else if(aiIndex == 3){
                        //System.out.printf("%s turn\n", playerName);
                        //dump();
                        // Call
                        if((highCount > 2) && (highCount > counts[highCard]+1)){
                                output = "call";
                        }else{ //bid based on B S or L card
                                output = bidAgent3(highCount, highCard);
                                //System.out.printf("Bidding %s %d %d\n", output, bcount, bcard);
                        }
                        return(output);
                }else if(aiIndex == 4){
                        output = turnAgent4(highCount, highCard);
                        return(output);
                }else{

                        dump();
                        output = util.prompt("Action(bid, call, quit)");
                        return(output);
                }
        }
        public void setAIIndex(int index){
                aiIndex = index;
                if(playerName == null){
                        if(index == 0){
                                playerName = util.prompt("Human Player Name");
                        }else{
                                playerName = String.format("AI%02d", index);
                        }
                }
        }

        public int getAIIndex(){
                return(aiIndex);
        }

        public void setName(String name){
                playerName = name;
        }

        public String getName(){
                return(playerName);
        }

        public void setNext(lpPlayer nextplayer){
                nextPlayer = nextplayer;
        }

        public lpPlayer getNext(){
                return(nextPlayer);
        }

        public void deal(int count, int maxcard){
                Hand.clear();
                for(int i=0; i<count; i++){
                        Hand.add((int) (Math.random() * (maxcard + 1)));
                }
                Collections.sort(Hand);
                if(aiIndex > 0){
                        // find best, second best and liar card
                        //System.out.println("init AI");
                        bcount=0;
                        scount=0;
                        for (int i = 0; i<=maxcard; i++){
                                opinions[i] = 0; // init opinions
                                counts[i] = howMany(i);
                                if(counts[i] >= bcount){
                                        scard = bcard;
                                        scount = bcount;
                                        scard = bcard;
                                        scount = bcount;
                                        bcount = counts[i];
                                        bcard = i;
                                }else if(counts[i] >= scount){
                                        scount = counts[i];
                                        scard = i;
                                }
                                if((counts[i] == 0) && (Math.random()*2 > 1)) { // smooth distribution of selected lie
                                        //System.out.printf("L changed to %d\n", i);
                                        lcard=i;
                                }
                        }
                }
                //System.out.printf("Bcount %d Bcard %d\n", bcount, bcard);
                //dump();
        }

        public void dump(){
                System.out.printf("Player: %s\n", getName());
                System.out.println(Arrays.toString(Hand.toArray()));
                //System.out.println(Hand.toString);
        }

        public int howMany(int input){
                int count =0;
                for (int card : Hand){
                        if(card == input){
                                count++;
                        }
                }
                return(count);
        }
}

$ cat LiarsPoker.java
import java.util.*;

public class LiarsPoker{

        int handSize = 8;
        int maxCard = 9;
        int highCard;
        int highCount;
        // Player 
        lpPlayer player = new lpPlayer();
        // Opponent
        lpPlayer opponent = new lpPlayer();
        lpPlayer whosFirst;

        lpUtil util = new lpUtil();

        private void setup(int playerIndex, int opponentIndex){
                player.setNext(opponent);
                opponent.setNext(player);

                //player.setName("player1");
                //opponent.setName("player2");

                opponent.setAIIndex(opponentIndex);
                player.setAIIndex(playerIndex);

                highCard = maxCard;
                highCount = 0;

                System.out.printf("\nDealing...\n\n");
                player.deal(handSize,maxCard);
                opponent.deal(handSize,maxCard);

                // Opponent goes first during first hand then alternate
                if(whosFirst == null){
                        whosFirst = opponent;
                }else{
                        whosFirst = whosFirst.getNext();
                }
        }

        private lpPlayer play(){
                lpPlayer activePlayer = whosFirst;
                lpPlayer winner = null;
                String turn;
                String bid;
                while(winner == null){
                        //System.out.println();
                        //if((highCount > 0) && (activePlayer.getAIIndex() == 0)){ //interactive
                                //System.out.printf("Current Bid: %d %d\'s\n", highCount, highCard);
                        //}
                        if(highCount == handSize*2 && highCard == maxCard){
                                System.out.printf("Current Bid is maximum, must be called\n");
                                winner = this.handleCall(activePlayer);
                        }else{
                                turn = activePlayer.takeTurn(highCount, highCard);
                                // switch
                                if(turn.indexOf("bid") != -1){
                                        this.handleBid(activePlayer,turn);
                                }else if(turn.equals("call")){
                                        winner = this.handleCall(activePlayer);
                                }else if(turn.equals("quit")){
                                        System.out.println("Quiting");
                                        winner = activePlayer.getNext();
                                }else if(turn.equals("AI")){
                                        System.out.println("AI turn complete");
                                }else{
                                        System.out.println("unsupported");
                                        continue;
                                }
 
                                activePlayer = activePlayer.getNext();
                        }
                }
                return(winner);
        }

        private lpPlayer handleCall(lpPlayer activePlayer){
                //System.out.printf("\nHandling Call of %d %d\n",highCount, highCard);
                System.out.printf("\n%d %d\'s have been called by %s\n", highCount, highCard, activePlayer.getName());
                int actCount = activePlayer.howMany(highCard) + (activePlayer.getNext()).howMany(highCard);
                activePlayer.dump();
                (activePlayer.getNext()).dump();
                //System.out.printf("P: %s B: %d A: %d\n", activePlayer.getName(), highCount, actCount);
                if(actCount<highCount){
                        return(activePlayer);
                }else{
                        return(activePlayer.getNext());
                }
        }

        private void handleBid(lpPlayer activePlayer, String input){
                int count=-1;
                int card=-1;
                String[] inputs = input.split("[ ]");
                if(inputs.length == 3){
                        count = Integer.parseInt(inputs[1]);
                        card = Integer.parseInt(inputs[2]);
                }

                //System.out.println("Handling Bid");
                boolean notDone = true;
                while(notDone){
                        // is input valid?
                        if(this.checkBid(count, card)){
                                //System.out.println("Good Bid");
                                highCount = count;
                                highCard = card;
                                notDone = false;
                        }else{
                                System.out.printf("Valid bids are:\n");
                                if(highCard < maxCard){
                                        System.out.printf("\t%d of %d or better\n", highCount, highCard+1);
                                }
                                if(highCount < handSize){
                                        System.out.printf("\t%d of any card\n", highCount+1);
                                }
                                input = util.prompt("Bid (count card)");
                                inputs = input.split("[ ]");
                                if(inputs.length != 2){
                                        continue;
                                }
                                count = Integer.parseInt(inputs[0]);
                                card = Integer.parseInt(inputs[1]);
                        }
                }
                System.out.printf("Player: %s bid %d %d\'s\n", activePlayer.getName(), highCount, highCard);
        }

        boolean checkBid (int count, int card){
                boolean result = true;
                if(count > handSize*2){
                        result = false;
                }
                if(card > maxCard){
                        result = false;
                }
                if(count < highCount){
                        result = false;
                }else if(count == highCount){
                        if(card<=highCard){
                                result = false;
                        }
                }
                return(result);

        }

        void usage (){

                System.out.println("Usage: cmd <playerIndex> <opponentIndex> <loopcount> <debug>");
        }
        public static void main (String[] args){
                int loopcount = 0;
                int playerIndex = 0;
                int opponentIndex = 0;
                int debug =0;

                //System.out.println("Setting up");
                LiarsPoker game = new LiarsPoker();
                if(args.length != 4){
                        game.usage();
                        System.exit(1);
                }else{
                        loopcount = Integer.parseInt(args[2]);
                        playerIndex = Integer.parseInt(args[0]);
                        opponentIndex = Integer.parseInt(args[1]);
                        debug = Integer.parseInt(args[3]);
                }

                System.out.printf("Welcome, starting Liars Poker with Player agent: %d and Opponent agent: %d for %d games\n", playerIndex, opponentIndex, loopcount);
                boolean goagain = true;
                String input;
                //while(goagain){
                for(int i=0; i<loopcount; i++){
                        game.setup(playerIndex, opponentIndex);
                        lpPlayer winner = game.play();
                        game.opponent.dumpCards();
                        System.out.printf("The winner was: %s\n-*-\t-*-\t-*-\n\n", winner.getName());
                        winner.addWin(1);
                        //input = game.util.prompt("Play again");
                        //if(input.indexOf("y") == -1){
                        //      goagain = false;
                        //}
                }
                System.out.printf("Player: %s Wins: %d\n",game.player.getName(), game.player.getWins());
                System.out.printf("Player: %s Wins: %d\n",game.opponent.getName(), game.opponent.getWins());
        }
}
